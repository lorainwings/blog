(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{423:function(t,a,s){"use strict";s.r(a);var e=s(27),v=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"性能优化总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#性能优化总结"}},[t._v("#")]),t._v(" 性能优化总结")]),t._v(" "),s("h2",{attrs:{id:"什么是-web-性能优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是-web-性能优化"}},[t._v("#")]),t._v(" 什么是 Web 性能优化")]),t._v(" "),s("p",[t._v("前端性能优化的目的: 让用户访问网站开始到页面完整展示出来的过程中, 通过各种优化策略和优化方法, 让页面加载的更快, 让用户操作响应更加及时, 给用户带来更好的用户体验")]),t._v(" "),s("h2",{attrs:{id:"为什么需要性能优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要性能优化"}},[t._v("#")]),t._v(" 为什么需要性能优化")]),t._v(" "),s("p",[t._v("研究表明, 网页性能差直接加速产品的衰败, 也影响网站收入(广告), 因此我们需要提升 Web 性能从而提升用户体验, 公司营收等")]),t._v(" "),s("h2",{attrs:{id:"优化步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化步骤"}},[t._v("#")]),t._v(" 优化步骤")]),t._v(" "),s("p",[t._v("以下笔者来详述所有常见的优化手段")]),t._v(" "),s("h2",{attrs:{id:"一、图片优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、图片优化"}},[t._v("#")]),t._v(" 一、图片优化")]),t._v(" "),s("h3",{attrs:{id:"图片格式选取"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#图片格式选取"}},[t._v("#")]),t._v(" 图片格式选取")]),t._v(" "),s("p",[t._v("JPEG(JPG/JPE): 有损压缩格式, 不支持透明度, 体积占用不大, 颜色细节质量不高, 颜色丰富, 通常网页大图(bannber / 轮播)等需要使用")]),t._v(" "),s("p",[t._v("PNG(PNG-8/PNG24): 无损压缩格式, 体积占用大, 细节表现好, 通常用于图标 / LOGO 等")]),t._v(" "),s("p",[t._v("GIF: 不支持半透明, 支持全透明, 通常用于动画图标")]),t._v(" "),s("p",[t._v("WEBP: Google 开源的图像格式, 无损的 WEBP 比 PNG 小 26%, 有损 WEBP 比 JPEG 小 25-34%, 比 GIF 有更好的动画, 但是兼容性不好, 需要做 Hack 处理")]),t._v(" "),s("h3",{attrs:{id:"图片压缩"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#图片压缩"}},[t._v("#")]),t._v(" 图片压缩")]),t._v(" "),s("p",[t._v("在实际的使用中, 必须对图片进行压缩, 常用以下工具进行压缩, 可以在本地压缩后上传至 CDN, 也可以在"),s("code",[t._v("Node")]),t._v("服务端使用在线处理:")]),t._v(" "),s("ul",[s("li",[t._v("在线压缩 TinyPng(TinyJpg)")]),t._v(" "),s("li",[t._v("JPG 压缩工具: Jpegtran")]),t._v(" "),s("li",[t._v("PNG 压缩工具: node-pngquant-native")]),t._v(" "),s("li",[t._v("GIF 压缩工具: Gifsicle")])]),t._v(" "),s("h3",{attrs:{id:"响应式图片"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#响应式图片"}},[t._v("#")]),t._v(" 响应式图片")]),t._v(" "),s("p",[t._v("不同的网络环境, 应该加载不同尺寸和像素的图片, 通过请求不同的 URL 参数")]),t._v(" "),s("p",[s("code",[t._v("httP://img.xxx.com/images/q100x100/c2exas....")]),t._v(" 对应的图片是 100x100")]),t._v(" "),s("p",[t._v("实现方式:")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("通过 JS 读取窗口大小, 选择合适的图片")])]),t._v(" "),s("li",[s("p",[t._v("通过媒体查询")])])]),t._v(" "),s("div",{staticClass:"language-css extra-class"},[s("pre",{pre:!0,attrs:{class:"language-css"}},[s("code",[s("span",{pre:!0,attrs:{class:"token atrule"}},[s("span",{pre:!0,attrs:{class:"token rule"}},[t._v("@media")]),t._v(" screen "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("max-width")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 640px"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v(".img_640")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("width")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 640px"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("通过 H5 的新属性"),s("code",[t._v("srcset")])])]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("srcset")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("img-320w"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n")])])]),s("h3",{attrs:{id:"逐步加载图片"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#逐步加载图片"}},[t._v("#")]),t._v(" 逐步加载图片")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("使用统一占位符")])]),t._v(" "),s("li",[s("p",[t._v("使用"),s("code",[t._v("LQIP")]),t._v("(低质量图像占位符)")]),t._v(" "),s("p",[t._v("安装: "),s("code",[t._v("npm install lqip")]),t._v(", 使用"),s("code",[t._v("lqip-loader")]),t._v("来引入")])]),t._v(" "),s("li",[s("p",[t._v("使用"),s("code",[t._v("SQIP")]),t._v("(基于 SVG 的图像占位符)")]),t._v(" "),s("p",[t._v("安装: "),s("code",[t._v("npm install sqip")])])])]),t._v(" "),s("h3",{attrs:{id:"图片降级方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#图片降级方案"}},[t._v("#")]),t._v(" 图片降级方案")]),t._v(" "),s("ul",[s("li",[t._v("Web Font 代替图片")]),t._v(" "),s("li",[t._v("使用 Data URI 代替图片")]),t._v(" "),s("li",[t._v("采用雪碧图（image spriting）")])]),t._v(" "),s("h2",{attrs:{id:"二、html-优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、html-优化"}},[t._v("#")]),t._v(" 二、HTML 优化")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("减少 HTML 的嵌套， 减少 DOM 的节点数")])]),t._v(" "),s("li",[s("p",[t._v("压缩 HTML，删除不必要的字符")])])]),t._v(" "),s("p",[t._v("可以使用构建工具的插件"),s("code",[t._v("html-webpack-plugin")])]),t._v(" "),s("ul",[s("li",[t._v("HTM 的结构优化")])]),t._v(" "),s("p",[s("code",[t._v("CSS")]),t._v("样式尽量放页面的头部, "),s("code",[t._v("JS引用放在HTML底部")])]),t._v(" "),s("p",[t._v("CSS 加载不会阻塞 DOM Tree 的解析, 但是会阻塞 DOM Tree 的渲染, 也会阻塞后面 JS 的执行。因此 body 元素之前， 可以确保在文档中解析了所有 CSS 样式， 从而减少了浏览器必须重排文档的次数。如果放在底部， 就需要等待最后一个 css 文件下载完成， 出现白屏，影响用户体验")]),t._v(" "),s("p",[t._v("JS 放在底部是防止加载、解析、执行对阻塞页面后续元素的正常渲染")]),t._v(" "),s("ul",[s("li",[t._v("设置 favicon.ico")])]),t._v(" "),s("p",[t._v("网站不设置 favicon.ico，控制台会报错，设置的优点是更便于用户对品牌的记忆")]),t._v(" "),s("ul",[s("li",[t._v("增加网页的骨架屏")])]),t._v(" "),s("h2",{attrs:{id:"三、css-优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、css-优化"}},[t._v("#")]),t._v(" 三、CSS 优化")]),t._v(" "),s("ul",[s("li",[t._v("避免使用通配符*和类正则属性选择器")]),t._v(" "),s("li",[t._v("避免使用类的多层级和装饰写法: div#elem.view ul li span{}")]),t._v(" "),s("li",[t._v("避免使用占用过多 CPU 和内存的属性: "),s("code",[t._v("text-indent: -9999px")])]),t._v(" "),s("li",[t._v("关注可继承的 CSS 属性, 避免重复定义相同的属性")]),t._v(" "),s("li",[t._v("避免使用 table 布局/float 布局, 一个 td 会导致整个回流")]),t._v(" "),s("li",[t._v("使用外链 css(CDN 部署),避免使用@import(阻塞 css 文件加载)")]),t._v(" "),s("li",[t._v("CSS 文件压缩")]),t._v(" "),s("li",[t._v("字体部署在 CDN, 或者将字体以 base64 保存在 css 中并通过 localstorage 缓存")]),t._v(" "),s("li",[t._v("Google 使用国内托管")]),t._v(" "),s("li",[t._v("CSS 复杂动画应该尽量将该元素脱离文档流, 否则会引起元素以后的所有元素频繁的回流")]),t._v(" "),s("li",[t._v("合理开启 GPU 加速(opacity/will-change/transform/filters), 过多的使用会导致内存占用大, 抗锯齿无效")])]),t._v(" "),s("h2",{attrs:{id:"四、js-优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、js-优化"}},[t._v("#")]),t._v(" 四、JS 优化")]),t._v(" "),s("h3",{attrs:{id:"js-代码优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#js-代码优化"}},[t._v("#")]),t._v(" JS 代码优化")]),t._v(" "),s("ul",[s("li",[t._v("JS 文件放在"),s("body",[t._v("底部")])]),t._v(" "),s("li",[t._v("使用节流和防抖")]),t._v(" "),s("li",[t._v("使用事件委托")]),t._v(" "),s("li",[t._v("避免使用 eval, 太耗性能")]),t._v(" "),s("li",[t._v("避免函数嵌套定义, 会导致多次预编译")]),t._v(" "),s("li",[t._v("JS 函数的参数类型尽量一致,V8 会调用 "),s("code",[t._v("turboFan")]),t._v(" 进行机器码编译优化")])]),t._v(" "),s("h3",{attrs:{id:"js-的动画优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#js-的动画优化"}},[t._v("#")]),t._v(" JS 的动画优化")]),t._v(" "),s("ul",[s("li",[t._v("避免添加大量 JS 动画")]),t._v(" "),s("li",[t._v("使用"),s("code",[t._v("requestAnimationFrame")]),t._v("代替"),s("code",[t._v("setTimeout")]),t._v("和"),s("code",[t._v("setInterval")])])]),t._v(" "),s("p",[s("code",[t._v("requestAnimationFrame")]),t._v("告诉浏览器在下次重绘前执行, 而"),s("code",[t._v("setTimeout")]),t._v("和"),s("code",[t._v("setInterval")]),t._v("无法保证回调的执行时机")]),t._v(" "),s("ul",[s("li",[t._v("动画最好使用 canvas")]),t._v(" "),s("li",[t._v("尽量使用 CSS3 动画方案")])]),t._v(" "),s("h3",{attrs:{id:"js-对-dom-的操作优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#js-对-dom-的操作优化"}},[t._v("#")]),t._v(" JS 对 DOM 的操作优化")]),t._v(" "),s("ul",[s("li",[t._v("防止频繁的操作 DOM, 尽量批量化操作")]),t._v(" "),s("li",[t._v("将 DOM 离线再进行大量操作")]),t._v(" "),s("li",[t._v("避免触发同步布局事件")])]),t._v(" "),s("p",[t._v("(offset|client|scroll)(Top|Left|Width|Height 的获取都应该缓存起来")]),t._v(" "),s("h2",{attrs:{id:"五、webpack-优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、webpack-优化"}},[t._v("#")]),t._v(" 五、Webpack 优化")]),t._v(" "),s("ul",[s("li",[t._v("依赖包优化(选用相同功能的小库)")]),t._v(" "),s("li",[t._v("缩小文件查询时间: (resolve.extension / resolve.mainFields / resolve.modules / resolve.alias)")]),t._v(" "),s("li",[t._v("Loader 优化(babel 的 cacheDirectory:true / include / exclude / module.noParse)")]),t._v(" "),s("li",[t._v("HappyPack 多进程打包 / hardSourceWebpackPlugin 设置中间模块缓存 / TerserWebpackPlugin / ingorePlugin / Dll 动态链接库 & DllReference")]),t._v(" "),s("li",[t._v("TreeShaking / Scope hosting")]),t._v(" "),s("li",[t._v("压缩 CSS(optimize-css-assets-webpack-plugin / mini-css-extract-plugin)")]),t._v(" "),s("li",[t._v("分包按需加载(splitChunks.cacheGroup)")]),t._v(" "),s("li",[t._v("long term cache (固化 js 的 chunkhash / 固化 css 的 contenthash / 固化 chunkId(optimize.chunkIds: 'hashd') / 固化 moduleIds(optimize.moduleIds:'name') / 按需加载模块使用魔法字符串'webpackChunkName' / 提取 webpack 的 runtime 代码)")])]),t._v(" "),s("h2",{attrs:{id:"六、使用缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#六、使用缓存"}},[t._v("#")]),t._v(" 六、使用缓存")]),t._v(" "),s("ul",[s("li",[t._v("memory cache")]),t._v(" "),s("li",[t._v("service worker")]),t._v(" "),s("li",[t._v("disk cache")]),t._v(" "),s("li",[t._v("push cache（一种存在于会话阶段的缓存，当 session 终止时，缓存也随之释放， 同一个 h2 连接可以共享）")])]),t._v(" "),s("h2",{attrs:{id:"七、浏览器的渲染过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#七、浏览器的渲染过程"}},[t._v("#")]),t._v(" 七、浏览器的渲染过程")]),t._v(" "),s("ol",[s("li",[t._v("浏览器解析 HTML，生成 DOM Tree")]),t._v(" "),s("li",[t._v("浏览器解析 CSS, 生成 CSSOM Tree")]),t._v(" "),s("li",[t._v("浏览器将 DOM Tree 和 CSSOM Tree 合成渲染树")]),t._v(" "),s("li",[t._v("布局: 根据生成的 Render Tree, 进行回流, 计算出每个节点的几何位置")]),t._v(" "),s("li",[t._v("绘制: 根据渲染树和回流得到几何信息,得到每个节点的绝对像素,并生成图层")]),t._v(" "),s("li",[t._v("CPU 将默认图层和复合图层输入到 GPU 进行合成, 最终的到了页面并展示")])]),t._v(" "),s("h2",{attrs:{id:"八、渲染优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#八、渲染优化"}},[t._v("#")]),t._v(" 八、渲染优化")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("服务端渲染")]),t._v(" "),s("p",[t._v("包括后端同步渲染、同构直出、BigPipe")])]),t._v(" "),s("li",[s("p",[t._v("客户端渲染")]),t._v(" "),s("p",[t._v("JS 渲染：静态化、前后端分离、单页面应用\nWebApp： React、 Vue、Angular、PWA\n原生 APP： IOS、Android\nHybridApp： PhoneGap、Appcan\n跨平台开发: RN、Flutter、 小程序")])])]),t._v(" "),s("h3",{attrs:{id:"预渲染"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#预渲染"}},[t._v("#")]),t._v(" 预渲染")]),t._v(" "),s("p",[t._v("同构方案集合 CSR 与 SSR 的优点，可以适用于大部分业务场景。但由于在同构的系统架构中，连接前后端的 Node 中间层处于核心链路，系统可用性的瓶颈就依赖于 Node ，一旦作为短板的 Node 挂了，整个服务都不可用")]),t._v(" "),s("p",[t._v("一般的场景,使用预渲染即可, 使用 webpack 插件"),s("code",[t._v("prerender-spa-plugin")])]),t._v(" "),s("p",[t._v("缺点:")]),t._v(" "),s("ol",[s("li",[t._v("预渲染只是快照页面, 不适合频繁变动页面")]),t._v(" "),s("li",[t._v("设置路由多, 构建时间增长")])]),t._v(" "),s("h3",{attrs:{id:"同构直出"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#同构直出"}},[t._v("#")]),t._v(" 同构直出")]),t._v(" "),s("p",[t._v("降低首屏渲染时间, 利于 SEO, 直接上线 2 个版本, 利于灾备")]),t._v(" "),s("ul",[s("li",[t._v("next.js 服务端渲染 React 组件框架")]),t._v(" "),s("li",[t._v("gatsbyjs: 服务端 React 渲染框架")]),t._v(" "),s("li",[t._v("nuxt.js 服务端渲染 Vue 框架")])]),t._v(" "),s("h3",{attrs:{id:"关于渲染的技术选型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关于渲染的技术选型"}},[t._v("#")]),t._v(" 关于渲染的技术选型")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("依赖业务形式: 根据业务情况, 选择最佳的业务方案")])]),t._v(" "),s("li",[s("p",[t._v("依赖团队规模: 创业初期选择同步直出 JSP, 后面团队变大可以使用同构直出"),s("code",[t._v("Node server")]),t._v(", 富余人力用 PWA 等等")])]),t._v(" "),s("li",[s("p",[t._v("依赖技术水平: 适合公司的技术水平, 选择合适的技术方案")])])]),t._v(" "),s("h2",{attrs:{id:"九、加载优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#九、加载优化"}},[t._v("#")]),t._v(" 九、加载优化")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("懒加载")])])]),t._v(" "),s("p",[t._v("对长网页延迟加载特定元素（图片、JS/CSS），也可以是 JS 的特定函数和方法，优点是减少当前屏无效资源的加载")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[s("strong",[t._v("预加载")])])]),t._v(" "),s("p",[t._v("让浏览器预加载某些资源（图片、js、css、模板），提前加载到本地，后面使用直接从缓存中获取，优点是减少用户后续加载资源的等待时间")]),t._v(" "),s("blockquote",[s("p",[t._v("方式一:")])]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://xxxx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token style-attr language-css"}},[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('="')]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token property"}},[t._v("display")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("none")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("方式二:")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" img "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nimg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://xxxx"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("方式三:")])]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 当前页需要的资源 as最高优先级,没有as被看做异步请求 --\x3e")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("preload"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("style.css"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("as")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 其他页需要的资源 --\x3e")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("prefetch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("image.png"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 预解析跨域的DNS,避免用来解析当前站 --\x3e")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("dns-prefetch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://xxx.com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 预先建立与服务器的连接 --\x3e")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("preconnect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://xxx.com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("crossorigin")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[s("strong",[t._v("预渲染")])])]),t._v(" "),s("blockquote",[s("p",[t._v("优点:")])]),t._v(" "),s("p",[t._v("懒加载组件出来之前, 用户需要时间等待完成; 还有一种预加载的方式是提前渲染, 渲染好后隐藏起来, 用的时候直接展示")]),t._v(" "),s("blockquote",[s("p",[t._v("实现方式:")])]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("prerender"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://xxx.com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[s("strong",[t._v("按需加载")])])]),t._v(" "),s("p",[t._v("可以分为"),s("code",[t._v("常规按需加载")]),t._v("(js 或者其他脚本)、不同 App 按需加载(js-sdk 脚本)、 不同设备按需加载(pc 和 h5 样式)、不同分辨率按需加载(css 媒体查询)")]),t._v(" "),s("h2",{attrs:{id:"十、接口优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#十、接口优化"}},[t._v("#")]),t._v(" 十、接口优化")]),t._v(" "),s("ol",[s("li",[t._v("接口合并")])]),t._v(" "),s("p",[t._v("一个页面很多业务接口和依赖的第三方接口统一起来，在部署在集群的接口上统一调用，减少页面请求")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("接口上 CDN")])]),t._v(" "),s("p",[t._v("这是基于接口的性能考虑，把不需要实时更新的接口同步到 CDN，等接口内容变更之后自动同步到 CDN 集群上。如果一定时间内未请求到数据，回源站接口请求")]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("接口域名上 CDN")])]),t._v(" "),s("p",[t._v("增强可用性，稳定性")]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[t._v("接口降级")])]),t._v(" "),s("p",[t._v("电商大促中，核心接口进行降级备用基础接口进行业务实现。例如推荐接口，大促可以直接用运营的编辑数据。防止接口无法使用时，备用垫底备份数据")]),t._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[t._v("接口监控")])]),t._v(" "),s("p",[t._v("不是指服务端的"),s("code",[t._v("TP99")]),t._v(",是指用户实际情况成功和失败的情况， 包括弱网、超时、网络异常、网络切换等")]),t._v(" "),s("ol",{attrs:{start:"6"}},[s("li",[t._v("接口缓存")])]),t._v(" "),s("p",[t._v("包括 ajax 缓存、本地缓存（localstorage）、重发请求（网络切换）")]),t._v(" "),s("h2",{attrs:{id:"十一、webview-优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#十一、webview-优化"}},[t._v("#")]),t._v(" 十一、WebView 优化")]),t._v(" "),s("p",[t._v("IOS 的 webveiw 分为"),s("code",[t._v("UIWebview")]),t._v("和"),s("code",[t._v("WKWebview")]),t._v(", 后者性能更优,内存占用较前者低,加载速度快,可以直接与 JS 互调函数, 而"),s("code",[t._v("UIWebview")]),t._v("需要第三方库来完善; "),s("code",[t._v("WKWebview")]),t._v("的缺点是不支持自动注入"),s("code",[t._v("cookie")]),t._v(",不支持 POST 参数")]),t._v(" "),s("p",[t._v("Android 的系统 webview 分为"),s("code",[t._v("Webkit Webview")]),t._v("和"),s("code",[t._v("chromium Webview")]),t._v("(更优秀), 第三方的 webview 主要有"),s("code",[t._v("X5内核")]),t._v(",速度更快, 兼容性更好, 国内各种手机厂商的碎片化支持更好, 视频播放更加强大")]),t._v(" "),s("p",[t._v("因此 IOS 选用"),s("code",[t._v("WKWebview")]),t._v("和 Android 使用"),s("code",[t._v("X5内核")])]),t._v(" "),s("ol",[s("li",[t._v("使用全局 Webview 优化")])]),t._v(" "),s("p",[t._v("APP 启动, 默认不初始化浏览器内核, 当创建实例时才启动内核, 大概有 70-700ms 延迟。客户端刚启动就初始化全局 webview， 需要使用时，直接加载内容；但是额外会消耗一些内存")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("URL 预加载")])]),t._v(" "),s("p",[t._v("准备和请求页面同步进行，URL load 和动画并行加载")]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("滚动条使用体验")])]),t._v(" "),s("p",[t._v("模拟 WIFI 下页面加载过程， 让用户感觉变快")]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[t._v("JS-SDK 的优化")])]),t._v(" "),s("p",[t._v("一般来说, 常用有三种方式可以调用 nativeApi, 包括"),s("code",[t._v("上下文注入")]),t._v("、"),s("code",[t._v("弹窗拦截")]),t._v("、"),s("code",[t._v("URL Scheme")]),t._v("等")]),t._v(" "),s("p",[t._v("现在可直接使用"),s("code",[t._v("webkit")]),t._v("直接调用")]),t._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[t._v("H5 离线包方案")])]),t._v(" "),s("p",[s("img",{attrs:{src:"/blog/skills/images/offline-frame.png",alt:"离线包"}})]),t._v(" "),s("p",[t._v("首先加载全局包->判断本地是否安装->如果安装了直接解包到内存->如果未安装去线上比对后下载再解包到内存->webview 加载资源时候直接读取内存中的数据->内存中存在直接返回->否则去线上地址取")]),t._v(" "),s("h2",{attrs:{id:"十一、混合式-app-rn-weex"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#十一、混合式-app-rn-weex"}},[t._v("#")]),t._v(" 十一、混合式 APP(RN/Weex)")]),t._v(" "),s("ol",[s("li",[t._v("RN 的实现方式")])]),t._v(" "),s("p",[s("img",{attrs:{src:"/blog/skills/images/hybrid-app.png",alt:"混合式App"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"/blog/skills/images/native-frame.png",alt:"底层架构"}})]),t._v(" "),s("p",[t._v("技术选型: React 技术全家桶可以选用 RN")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("Flutter 的实现方式")])]),t._v(" "),s("p",[s("img",{attrs:{src:"/blog/skills/images/flutter-bottom-layer.png",alt:"底层架构"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"/blog/skills/images/bottom-layer-compare.png",alt:"底层比较"}}),t._v(")")]),t._v(" "),s("p",[t._v("学习曲线: 相对比 RN 高,重新学习 Dart 语言")]),t._v(" "),s("p",[t._v("性能: Native 性能最好,直接和 "),s("code",[t._v("Skia(C/C++)")]),t._v(" 引擎通信,没有 "),s("code",[t._v("JS Bridge")]),t._v(" 层")]),t._v(" "),s("p",[t._v("选型建议: 考虑性能, 业务面向多终端, APP 团队人员多")]),t._v(" "),s("h2",{attrs:{id:"十二、cdn-优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#十二、cdn-优化"}},[t._v("#")]),t._v(" 十二、CDN 优化")]),t._v(" "),s("h3",{attrs:{id:"优点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优点"}},[t._v("#")]),t._v(" 优点")]),t._v(" "),s("p",[t._v("避免 Ddos 攻击、高可用性处理高流量和负载、节省流量")]),t._v(" "),s("h3",{attrs:{id:"http-请求流程说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http-请求流程说明"}},[t._v("#")]),t._v(" HTTP 请求流程说明")]),t._v(" "),s("p",[t._v("1、用户在浏览器输入要访问的网站域名，向本地 DNS 发起域名解析请求。")]),t._v(" "),s("p",[t._v("2、域名解析的请求被发往网站授权 DNS 服务器。")]),t._v(" "),s("p",[t._v("3、网站 DNS 服务器解析发现域名已经 CNAME 到了 www.example.com.c.cdnhwc1.com。")]),t._v(" "),s("p",[t._v("4、请求被指向 CDN 服务。")]),t._v(" "),s("p",[t._v("5、CDN 对域名进行智能解析，将响应速度最快的 CDN 节点 IP 地址返回给本地 DNS。")]),t._v(" "),s("p",[t._v("6、用户获取响应速度最快的 CDN 节点 IP 地址。")]),t._v(" "),s("p",[t._v("7、浏览器在得到速度最快节点的 IP 地址以后，向 CDN 节点发出访问请求。")]),t._v(" "),s("p",[t._v("8、CDN 节点将用户所需资源返回给用户。")]),t._v(" "),s("h3",{attrs:{id:"cdn-缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cdn-缓存"}},[t._v("#")]),t._v(" CDN 缓存")]),t._v(" "),s("p",[t._v("常用建议：")]),t._v(" "),s("ul",[s("li",[t._v("HTML：3 分钟")]),t._v(" "),s("li",[t._v("JS/CSS: 10 分钟、1 天、30 天")])]),t._v(" "),s("p",[t._v("CDN 的"),s("code",[t._v("Nginx")]),t._v("中通过设置 expires 字段的时长")]),t._v(" "),s("h3",{attrs:{id:"cdn-灰度发布"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cdn-灰度发布"}},[t._v("#")]),t._v(" CDN 灰度发布")]),t._v(" "),s("p",[t._v("不会区域/地区部分运营商优先发布静态资源, 验证通过后, 再进行全量发布")]),t._v(" "),s("p",[t._v("通过设置特殊 VIP 解析至要灰度的城市/运营商")]),t._v(" "),s("h3",{attrs:{id:"cdn-备战"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cdn-备战"}},[t._v("#")]),t._v(" CDN 备战")]),t._v(" "),s("p",[t._v("如果是大促, "),s("code",[t._v("增加机房带宽")]),t._v(" / "),s("code",[t._v("增加运营商流量")]),t._v(" / "),s("code",[t._v("CDN 应用缓存时间由 10 分钟设置成 1 小时, 大促后恢复")])]),t._v(" "),s("h2",{attrs:{id:"十三、dns-优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#十三、dns-优化"}},[t._v("#")]),t._v(" 十三、DNS 优化")]),t._v(" "),s("h3",{attrs:{id:"客户端处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端处理"}},[t._v("#")]),t._v(" 客户端处理")]),t._v(" "),s("h4",{attrs:{id:"android-中采用-一些-dns-模块-okhttp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#android-中采用-一些-dns-模块-okhttp"}},[t._v("#")]),t._v(" Android 中采用 一些 DNS 模块（okhttp）")]),t._v(" "),s("ul",[s("li",[t._v("支持 H2")]),t._v(" "),s("li",[t._v("连接池复用减少延迟")]),t._v(" "),s("li",[t._v("支持 GZIP，压缩体积")]),t._v(" "),s("li",[t._v("响应缓存可以避免网络重复请求")]),t._v(" "),s("li",[t._v("配置了多个 IP 地址， 一个 IP 失败，OKhttp 自动尝试下一个")])]),t._v(" "),s("h4",{attrs:{id:"ios-中可以采用自研-dns-模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ios-中可以采用自研-dns-模块"}},[t._v("#")]),t._v(" IOS 中可以采用自研 DNS 模块")]),t._v(" "),s("ul",[s("li",[t._v("APP 启动时，缓存所有可能要用到的域名 IP，同时异步处理，客户端无需缓存")]),t._v(" "),s("li",[t._v("Cache 中有域名缓存， 直接使用缓存")]),t._v(" "),s("li",[t._v("没有缓存则重新向 Http server 申请")])]),t._v(" "),s("h4",{attrs:{id:"web-前端中的处理-浏览器有并发数限制-做域名分散-资源分布在多个域名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#web-前端中的处理-浏览器有并发数限制-做域名分散-资源分布在多个域名"}},[t._v("#")]),t._v(" Web 前端中的处理， 浏览器有并发数限制，做域名分散，资源分布在多个域名")]),t._v(" "),s("ul",[s("li",[t._v("Java、php 等 API 接口放在一个域名")]),t._v(" "),s("li",[t._v("页面和样式（HTML/JS/CSS）放在一个域名")]),t._v(" "),s("li",[t._v("图片（jpg、png、gif）放在一个域名")])]),t._v(" "),s("h2",{attrs:{id:"十四、http-优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#十四、http-优化"}},[t._v("#")]),t._v(" 十四、HTTP 优化")]),t._v(" "),s("h3",{attrs:{id:"减少-http-请求数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#减少-http-请求数"}},[t._v("#")]),t._v(" 减少 HTTP 请求数")]),t._v(" "),s("ul",[s("li",[t._v("css sprites")]),t._v(" "),s("li",[t._v("图片使用 DataURI、Web Font")]),t._v(" "),s("li",[t._v("JS/CSS 文件合并")]),t._v(" "),s("li",[t._v("JS/CSS 请求 combo")]),t._v(" "),s("li",[t._v("接口合并")]),t._v(" "),s("li",[t._v("接口存储 localstorage")]),t._v(" "),s("li",[t._v("静态资源存储 localstorage")])]),t._v(" "),s("h3",{attrs:{id:"减小-cookie-大小"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#减小-cookie-大小"}},[t._v("#")]),t._v(" 减小 Cookie 大小")]),t._v(" "),s("ul",[s("li",[t._v("主站首页设置白名单")]),t._v(" "),s("li",[t._v("定期删除非白名单 Cookie")]),t._v(" "),s("li",[t._v("cookie 设置子域名，防止静态资源挟带 cookie")]),t._v(" "),s("li",[t._v("设置合理的过期时长")])]),t._v(" "),s("blockquote",[s("p",[t._v("cookie 什么时候才会自动携带呢?")])]),t._v(" "),s("p",[s("img",{attrs:{src:"/blog/skills/images/cookie-take.png",alt:"cookie"}})]),t._v(" "),s("p",[t._v("如果满足下面几个条件：")]),t._v(" "),s("p",[t._v("1、浏览器端某个 Cookie 的 domain 字段等于 aaa.www.com 或者 www.com")]),t._v(" "),s("p",[t._v("2、都是 http 或者 https，或者不同的情况下 Secure 属性为 false")]),t._v(" "),s("p",[t._v("3、要发送请求的路径，即上面的 xxxxx 跟浏览器端 Cookie 的 path 属性必须一致，或者是浏览器端 Cookie 的 path 的子目录，比如浏览器端 Cookie 的 path 为/test，那么 xxxxxxx 必须为/test 或者/test/xxxx 等子目录才可以")]),t._v(" "),s("h3",{attrs:{id:"ngix-开启-gzip-压缩"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ngix-开启-gzip-压缩"}},[t._v("#")]),t._v(" Ngix 开启 Gzip 压缩")]),t._v(" "),s("p",[t._v("HTTP 请求头 Accept-Encoding 会将客户端能够理解的内容编码方式——通常是某种压缩算法——进行通知（给服务端）。通过内容协商的方式，服务端会选择一个客户端提议的方式，使用并在响应头 Content-Encoding 中通知客户端该选择。")]),t._v(" "),s("p",[t._v("Nginx 配置: nginx.conf 文件增加 "),s("code",[t._v("gzip on")])]),t._v(" "),s("p",[t._v("Apache 配置: "),s("code",[t._v("AddOutputFilterByType")]),t._v(" 和 "),s("code",[t._v("AddOutputFilter")])]),t._v(" "),s("h3",{attrs:{id:"开启-https"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开启-https"}},[t._v("#")]),t._v(" 开启 HTTPS")]),t._v(" "),s("p",[t._v("优点: "),s("code",[t._v("利于SEO")]),t._v("和"),s("code",[t._v("更加安全")])]),t._v(" "),s("p",[t._v("实施步骤:")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("购买证书(GoGetSSL / SSLs.com / SSLmate.com)")])]),t._v(" "),s("li",[s("p",[t._v("本地安装测试证书")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("// 通过HomeBrew安装\nbrew "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" mkcert\n// 本地安装根证书\nmkcert --insatll\n// 本地生成签名\nmkcert xxx.com\n\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("本地 nginx 配置")])]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用HTTPS")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" xxx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#刚才的签名")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_certificate")]),t._v(" xxx"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pem"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_certificate_key")]),t._v(" xxx"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("y"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pem"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),s("h3",{attrs:{id:"使用-http2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-http2"}},[t._v("#")]),t._v(" 使用 HTTP2")]),t._v(" "),s("ul",[s("li",[t._v("二进制传输")]),t._v(" "),s("li",[t._v("多路复用 TCP 连接")]),t._v(" "),s("li",[t._v("header 头部压缩")]),t._v(" "),s("li",[t._v("服务端推送")])]),t._v(" "),s("p",[s("code",[t._v("缺点是如果一个TCP包丢失,会导致整个TCP的数据重传")])]),t._v(" "),s("ol",[s("li",[t._v("升级 OpenSSL")])]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("openssl version\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("重新编译")])]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" nginx-xxx\n./configure --with-http_ssl_module --with-http_v2_module\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" insatll\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("配置 Nginx 的字段")])]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl")]),t._v(" http2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用http2")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" xxx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#刚才的签名")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_certificate")]),t._v(" xxx"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pem"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_certificate_key")]),t._v(" xxx"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("y"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pem"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("验证 HTTP2")])]),t._v(" "),s("p",[t._v("浏览器下查看有没有小绿锁")]),t._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[t._v("查看浏览器请求的快照 protocol 字段 是不是 "),s("code",[t._v("h2")])])]),t._v(" "),s("h2",{attrs:{id:"十五、性能优化指标"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#十五、性能优化指标"}},[t._v("#")]),t._v(" 十五、性能优化指标")]),t._v(" "),s("p",[t._v("每个字段的具体含义这里不展开介绍，具体可以看 W3C 对应文档。")]),t._v(" "),s("h3",{attrs:{id:"性能指标"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#性能指标"}},[t._v("#")]),t._v(" 性能指标")]),t._v(" "),s("ol",[s("li",[t._v("DNS 解析耗时: domainLookupEnd - domainLookupStart")]),t._v(" "),s("li",[t._v("TCP 连接耗时: connectEnd - connectStart")]),t._v(" "),s("li",[t._v("SSL 安全连接耗时: connectEnd - secureConnectionStart")]),t._v(" "),s("li",[t._v("网络请求耗时(TTFB): responseStart - requestStart")]),t._v(" "),s("li",[t._v("数据传输耗时: responseEnd - responseStart")]),t._v(" "),s("li",[t._v("DOM 解析耗时: domInteractive - responseEnd")]),t._v(" "),s("li",[t._v("资源加载耗时: loadEventStart - domContentLoadedEventEnd")]),t._v(" "),s("li",[t._v("首包时间: responseStart - domainLookupStart")]),t._v(" "),s("li",[t._v("首次渲染时间 / 白屏时间: responseEnd - fetchStart")]),t._v(" "),s("li",[t._v("首次可交互时间: domInteractive - fetchStart")]),t._v(" "),s("li",[t._v("DOM Ready 时间: domContentLoadEventEnd - fetchStart")]),t._v(" "),s("li",[t._v("页面完全加载时间: loadEventStart - fetchStart")])]),t._v(" "),s("p",[t._v("参考文档:")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.w3.org/TR/navigation-timing/#performancetiming",target:"_blank",rel:"noopener noreferrer"}},[t._v("W3C 性能指标"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=v.exports}}]);