<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Generator | Lorain&#39;s ä¸ªäººä¸»é¡µğŸ–Œ</title>
    <meta name="generator" content="VuePress 1.8.1">
    <link rel="icon" href="/blog/base/hd-img.jpg">
    <link rel="manifest" href="/blog/manifest.json">
    <link rel="apple-touch-icon" href="/blog/base/hd-img.jpg">
    <meta name="description" content="å±±ä¸­æ¨—æ å¹´å¹´åœ¨ & çœ‹å°½è¥¿é£æœ¨æ§¿èŠ±">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta http-quiv="pragma" cotent="no-cache">
    <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
    <meta http-quiv="expires" cotent="0">
    
    <link rel="preload" href="/blog/assets/css/0.styles.68529e48.css" as="style"><link rel="preload" href="/blog/assets/js/app.fca59600.js" as="script"><link rel="preload" href="/blog/assets/js/3.8a6bfa10.js" as="script"><link rel="preload" href="/blog/assets/js/23.f5fdb6b0.js" as="script"><link rel="preload" href="/blog/assets/js/4.3c831ab3.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.40f921fc.js"><link rel="prefetch" href="/blog/assets/js/11.b1a5db24.js"><link rel="prefetch" href="/blog/assets/js/12.32eadbcb.js"><link rel="prefetch" href="/blog/assets/js/13.605aab50.js"><link rel="prefetch" href="/blog/assets/js/14.e621e259.js"><link rel="prefetch" href="/blog/assets/js/15.a17f293c.js"><link rel="prefetch" href="/blog/assets/js/16.4cf8e286.js"><link rel="prefetch" href="/blog/assets/js/17.0187e264.js"><link rel="prefetch" href="/blog/assets/js/18.a9a7f87d.js"><link rel="prefetch" href="/blog/assets/js/19.39221c93.js"><link rel="prefetch" href="/blog/assets/js/20.763a09e2.js"><link rel="prefetch" href="/blog/assets/js/21.abd84741.js"><link rel="prefetch" href="/blog/assets/js/22.621fc027.js"><link rel="prefetch" href="/blog/assets/js/24.d179bd37.js"><link rel="prefetch" href="/blog/assets/js/25.79c3d42c.js"><link rel="prefetch" href="/blog/assets/js/26.7e5fb699.js"><link rel="prefetch" href="/blog/assets/js/27.6d2e2ca2.js"><link rel="prefetch" href="/blog/assets/js/28.711f2fab.js"><link rel="prefetch" href="/blog/assets/js/29.b7f987c3.js"><link rel="prefetch" href="/blog/assets/js/30.0a3630f2.js"><link rel="prefetch" href="/blog/assets/js/31.9490002b.js"><link rel="prefetch" href="/blog/assets/js/32.0b088754.js"><link rel="prefetch" href="/blog/assets/js/33.46448628.js"><link rel="prefetch" href="/blog/assets/js/34.9212905b.js"><link rel="prefetch" href="/blog/assets/js/35.5013d6d2.js"><link rel="prefetch" href="/blog/assets/js/36.531ff59f.js"><link rel="prefetch" href="/blog/assets/js/37.52f1002a.js"><link rel="prefetch" href="/blog/assets/js/38.3a2afa1a.js"><link rel="prefetch" href="/blog/assets/js/39.e65253d3.js"><link rel="prefetch" href="/blog/assets/js/40.92a22c61.js"><link rel="prefetch" href="/blog/assets/js/41.01c2e535.js"><link rel="prefetch" href="/blog/assets/js/42.fca6ea9d.js"><link rel="prefetch" href="/blog/assets/js/43.6e4dac46.js"><link rel="prefetch" href="/blog/assets/js/44.048fab3d.js"><link rel="prefetch" href="/blog/assets/js/45.60a1d461.js"><link rel="prefetch" href="/blog/assets/js/5.8a039903.js"><link rel="prefetch" href="/blog/assets/js/6.29bb3ac6.js"><link rel="prefetch" href="/blog/assets/js/7.ae762a13.js"><link rel="prefetch" href="/blog/assets/js/8.2597e5ec.js"><link rel="prefetch" href="/blog/assets/js/9.f2677d57.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.62a8c583.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.68529e48.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Lorain's ä¸ªäººä¸»é¡µğŸ–Œ</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/skills/" class="nav-link router-link-active">
  ğŸ“œå‰ç«¯æŠ€æœ¯
</a></div><div class="nav-item"><a href="/blog/algorithm/" class="nav-link">
  ğŸ“Šè®¡ç®—æœºåŸºç¡€
</a></div><div class="nav-item"><a href="/blog/life/" class="nav-link">
  ğŸ€å…¶ä»–è®°å½•
</a></div><div class="nav-item"><a href="https://github.com/lorainwings" target="_blank" rel="noopener noreferrer" class="nav-link external">
  â­ï¸Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/skills/" class="nav-link router-link-active">
  ğŸ“œå‰ç«¯æŠ€æœ¯
</a></div><div class="nav-item"><a href="/blog/algorithm/" class="nav-link">
  ğŸ“Šè®¡ç®—æœºåŸºç¡€
</a></div><div class="nav-item"><a href="/blog/life/" class="nav-link">
  ğŸ€å…¶ä»–è®°å½•
</a></div><div class="nav-item"><a href="https://github.com/lorainwings" target="_blank" rel="noopener noreferrer" class="nav-link external">
  â­ï¸Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JSè¯­è¨€åŸºç¡€</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/skills/Promise.html" class="sidebar-link">Promise</a></li><li><a href="/blog/skills/Generator.html" aria-current="page" class="active sidebar-link">Generator</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/skills/Generator.html#å‡½æ•°" class="sidebar-link">å‡½æ•°</a></li><li class="sidebar-sub-header"><a href="/blog/skills/Generator.html#éå†" class="sidebar-link">éå†</a></li><li class="sidebar-sub-header"><a href="/blog/skills/Generator.html#generatorä½œç”¨-å®ç°" class="sidebar-link">Generatorä½œç”¨ &amp; å®ç°</a></li></ul></li><li><a href="/blog/skills/Set &amp; Map.html" class="sidebar-link">Set &amp; Map</a></li><li><a href="/blog/skills/Event-loop.html" class="sidebar-link">Event Loop</a></li><li><a href="/blog/skills/è¯»ä½ ä¸çŸ¥é“çš„JS.html" class="sidebar-link">è¯»ä½ ä¸çŸ¥é“çš„ JS</a></li><li><a href="/blog/skills/æ­£åˆ™è¡¨è¾¾å¼å°çŸ¥è¯†.html" class="sidebar-link">æ­£åˆ™è¡¨è¾¾å¼å°çŸ¥è¯†</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>H5åŠæ¡†æ¶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å‰ç«¯å·¥ç¨‹åŒ–</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å®‰å…¨åŠæ€§èƒ½ä¼˜åŒ–</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æœåŠ¡ç«¯å…¥é—¨</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="generator"><a href="#generator" class="header-anchor">#</a> Generator</h1> <p>æœ¬ç¯‡ä¸»è¦è®°å½• ES6 ä¸­å‡½æ•°ç›¸å…³çŸ¥è¯†, ä»¥åŠ Generator çš„è‡ªæ‰§è¡Œ</p> <h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="header-anchor">#</a> å‡½æ•°</h2> <p>å‡½æ•°åˆ†ç±»ä¼—å¤š,é«˜é˜¶å‡½æ•°(HOF)çš„åº”ç”¨å¹¿æ³›, æœ¬å°èŠ‚è®°å½•ä¸»è¦æ˜¯ä»¥ä¸‹ä¸‰ç§å‡½æ•°é«˜é˜¶å‡½æ•°</p> <ul><li>åå‡½æ•°</li> <li>æƒ°æ€§å‡½æ•°</li> <li>æŸ¯é‡ŒåŒ–å‡½æ•°</li> <li>Thunk å‡½æ•°</li></ul> <h3 id="åå‡½æ•°-partial"><a href="#åå‡½æ•°-partial" class="header-anchor">#</a> åå‡½æ•°(partial)</h3> <div class="custom-block tip"><p class="custom-block-title">æ¦‚å¿µ</p> <p><code>åå‡½æ•°</code>æ˜¯å›ºå®šä¸€ä¸ªå‡½æ•°çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯å°†ä¸€ä¸ª n å…ƒå‡½æ•°è½¬æ¢æˆä¸€ä¸ª n - x å…ƒå‡½æ•°</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// æ‰§è¡Œ add å‡½æ•°ï¼Œä¸€æ¬¡ä¼ å…¥ä¸¤ä¸ªå‚æ•°å³å¯</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>

<span class="token comment">// å‡è®¾æœ‰ä¸€ä¸ª partial å‡½æ•°å¯ä»¥åšåˆ°å±€éƒ¨åº”ç”¨</span>
<span class="token keyword">var</span> addOne <span class="token operator">=</span> <span class="token function">partial</span><span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">addOne</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
</code></pre></div><h3 id="æƒ°æ€§å‡½æ•°"><a href="#æƒ°æ€§å‡½æ•°" class="header-anchor">#</a> æƒ°æ€§å‡½æ•°</h3> <div class="custom-block tip"><p class="custom-block-title">æ¦‚å¿µ</p> <p>å½“æˆ‘ä»¬æ¯æ¬¡éƒ½éœ€è¦è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œå…¶å®åªéœ€è¦åˆ¤æ–­ä¸€æ¬¡ï¼Œæ¥ä¸‹æ¥çš„ä½¿ç”¨æ–¹å¼éƒ½ä¸ä¼šå‘ç”Ÿæ”¹å˜çš„æ—¶å€™,å°†ä¸å˜çš„åœ°æ–¹å›ºå®šåŒ–(å±€éƒ¨åŒ–)</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> t<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">return</span> t<span class="token punctuation">;</span>
    t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> t<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="æŸ¯é‡ŒåŒ–å‡½æ•°"><a href="#æŸ¯é‡ŒåŒ–å‡½æ•°" class="header-anchor">#</a> æŸ¯é‡ŒåŒ–å‡½æ•°</h3> <div class="custom-block tip"><p class="custom-block-title">æ¦‚å¿µ</p> <p>å°†ä¸€ä¸ªå¤šå‚æ•°å‡½æ•°è½¬æ¢æˆå¤šä¸ªå•å‚æ•°å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å°†ä¸€ä¸ª n å…ƒå‡½æ•°è½¬æ¢æˆ n ä¸ªä¸€å…ƒå‡½æ•°</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// æ‰§è¡Œ add å‡½æ•°ï¼Œä¸€æ¬¡ä¼ å…¥ä¸¤ä¸ªå‚æ•°å³å¯</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>

<span class="token comment">// å‡è®¾æœ‰ä¸€ä¸ª curry å‡½æ•°å¯ä»¥åšåˆ°æŸ¯é‡ŒåŒ–</span>
<span class="token keyword">var</span> addCurry <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">addCurry</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
</code></pre></div><h3 id="thunk-å‡½æ•°"><a href="#thunk-å‡½æ•°" class="header-anchor">#</a> Thunk å‡½æ•°</h3> <p>ä¸Šä¸ªä¸–çºª 60 å¹´ä»£å¼•å‡ºäº†ä¸€ä¸ªç¼–ç¨‹</p> <blockquote><p>å‡½æ•°çš„å‚æ•°åˆ°åº•åº”è¯¥ä½•æ—¶æ±‚å€¼, å³<code>æ±‚å€¼ç­–ç•¥</code></p></blockquote> <p>æœ€åå½¢æˆäº†ä¸¤ç§æ–¹æ¡ˆ<code>ä¼ å€¼è°ƒç”¨</code>(C è¯­è¨€ã€JS)å’Œ<code>ä¼ åè°ƒç”¨</code>(Haskell è¯­è¨€)</p> <div class="custom-block tip"><p class="custom-block-title">ä¼ åè°ƒç”¨çš„å®ç°</p> <p>ç¼–è¯‘å™¨çš„â€œä¼ åè°ƒç”¨â€å®ç°ï¼Œå¾€å¾€æ˜¯å°†å‚æ•°æ”¾åˆ°ä¸€ä¸ªä¸´æ—¶å‡½æ•°ä¹‹ä¸­ï¼Œå†å°†è¿™ä¸ªä¸´æ—¶å‡½æ•°ä¼ å…¥å‡½æ•°ä½“ã€‚è¿™ä¸ªä¸´æ—¶å‡½æ•°å°±å«åš <code>Thunk å‡½æ•°</code></p></div> <div class="custom-block tip"><p class="custom-block-title">Javascript çš„å®ç°</p> <p>Thunk å‡½æ•°æ›¿æ¢çš„ä¸æ˜¯è¡¨è¾¾å¼ï¼Œè€Œæ˜¯å¤šå‚æ•°å‡½æ•°ï¼Œå°†å…¶æ›¿æ¢æˆä¸€ä¸ªåªæ¥å—å›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°çš„å•å‚æ•°å‡½æ•°, è¿™ä¸ªå•å‚æ•°çš„å‡½æ•°å°±å« <code>Thunk å‡½æ•°</code></p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æ­£å¸¸ç‰ˆæœ¬çš„readFileï¼ˆå¤šå‚æ•°ç‰ˆæœ¬ï¼‰</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Thunkç‰ˆæœ¬çš„readFileï¼ˆå•å‚æ•°ç‰ˆæœ¬ï¼‰</span>
<span class="token keyword">var</span> <span class="token function-variable function">Thunk</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fileName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> readFileThunk <span class="token operator">=</span> <span class="token function">Thunk</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">readFileThunk</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="éå†"><a href="#éå†" class="header-anchor">#</a> éå†</h2> <p>ES6 ä¸€å…±æœ‰ 5 ç§æ–¹æ³•å¯ä»¥éå†å¯¹è±¡çš„å±æ€§</p> <ul><li><p><code>for...in</code></p> <p>for...in å¾ªç¯éå†å¯¹è±¡è‡ªèº«çš„å’Œç»§æ‰¿çš„å¯æšä¸¾å±æ€§ï¼ˆä¸å« Symbol å±æ€§ï¼‰ã€‚</p></li> <li><p><code>Object.keys(obj)</code></p> <p>Object.keys è¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…æ‹¬å¯¹è±¡è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰å¯æšä¸¾å±æ€§ï¼ˆä¸å« Symbol å±æ€§ï¼‰çš„é”®åã€‚</p></li> <li><p><code>Object.getOwnPropertyNames(obj)</code></p> <p>Object.getOwnPropertyNames è¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«å¯¹è±¡è‡ªèº«çš„æ‰€æœ‰å±æ€§ï¼ˆä¸å« Symbol å±æ€§ï¼Œä½†æ˜¯åŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§ï¼‰çš„é”®åã€‚</p></li> <li><p><code>Object.getOwnPropertySymbols(obj)</code></p> <p>Object.getOwnPropertySymbols è¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«å¯¹è±¡è‡ªèº«çš„æ‰€æœ‰ Symbol å±æ€§çš„é”®åã€‚</p></li> <li><p><code>Reflect.ownKeys(obj)</code></p> <p>Reflect.ownKeys è¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«å¯¹è±¡è‡ªèº«çš„æ‰€æœ‰é”®åï¼Œä¸ç®¡é”®åæ˜¯ Symbol æˆ–å­—ç¬¦ä¸²ï¼Œä¹Ÿä¸ç®¡æ˜¯å¦å¯æšä¸¾ã€‚</p></li></ul> <h2 id="generatorä½œç”¨-å®ç°"><a href="#generatorä½œç”¨-å®ç°" class="header-anchor">#</a> Generatorä½œç”¨ &amp; å®ç°</h2> <p>æœ¬èŠ‚ä¸»è¦åˆ†æ<code>Generator</code>çš„ä½œç”¨åŠå®ç°è‡ªåŠ¨æ‰§è¡Œçš„ <code>Generator</code>, ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†:</p> <h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="header-anchor">#</a> ç‰¹ç‚¹</h3> <ul><li>å¯ä»¥æš‚åœæ‰§è¡Œå’Œæ¢å¤æ‰§è¡Œ
<blockquote><p>è¿™æ˜¯å®ƒèƒ½å°è£…å¼‚æ­¥ä»»åŠ¡çš„æ ¹æœ¬åŸå› </p></blockquote></li> <li>å‡½æ•°ä½“å†…å¤–çš„æ•°æ®äº¤æ¢</li> <li>é”™è¯¯å¤„ç†æœºåˆ¶</li></ul> <p>é‰´äºä¸Šé¢å‡ æ¡ç‰¹ç‚¹, ä½¿å¾—<code>Generator</code>å¯ä»¥æˆä¸ºå¼‚æ­¥ç¼–ç¨‹çš„<strong>å®Œæ•´è§£å†³æ–¹æ¡ˆ</strong></p> <h3 id="æ‰§è¡Œæµç¨‹"><a href="#æ‰§è¡Œæµç¨‹" class="header-anchor">#</a> æ‰§è¡Œæµç¨‹</h3> <p>Generator è°ƒç”¨è¿”å›çš„æ˜¯ä¸€ä¸ª <code>Iterator è¿­ä»£å™¨å¯¹è±¡</code>,åªæœ‰è°ƒç”¨è¯¥å¯¹è±¡çš„ next æ–¹æ³•æ‰ å¼€å§‹æ‰§è¡Œ, åŒæ—¶é‡åˆ° yield å°†åœä¸‹, è¿”å›ä¸€ä¸ªå€¼å¯¹è±¡;
æ¯æ¬¡ next è°ƒç”¨è¿”å›çš„æ˜¯ yield åé¢çš„å€¼, è€Œ yield æ•´ä¸ªè¡¨è¾¾å¼çš„å€¼é»˜è®¤ä¸º undefined;
next æ–¹æ³•ä¼ å…¥å‚æ•°, è¯¥å‚æ•°å¯ä»¥å°† <strong>ä¸Šä¸€æ¬¡</strong> çš„ yield è¡¨è¾¾å¼çš„å€¼è®¾ç½®ä¸ºè¯¥å€¼</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">hw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token number">123</span> <span class="token operator">+</span> <span class="token number">456</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> r <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">888</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">'end'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//æ‰§è¡Œ1   å…ˆè¿”å›ä¸€ä¸ªIteratorè¿­ä»£å™¨å¯¹è±¡</span>
<span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token function">hw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* æ‰§è¡Œ2
 *        ä½¿ç”¨nextå¯åŠ¨Generatorçš„æ‰§è¡Œ,é‡è§yieldå°±åœæ­¢,åŒæ—¶è¿”å›
 *        yieldåé¢çš„è®¡ç®—å€¼ { value: '579', done: false }
 */</span>
p<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* æ‰§è¡Œ3
 *        å¼€å§‹ä¸‹ä¸€æ¬¡æ‰§è¡Œ,ä»ä¸Šæ¬¡yieldè¡¨è¾¾å¼åœä¸‹çš„åœ°æ–¹ï¼Œä¸€ç›´æ‰§è¡Œåˆ°ä¸‹
 *        ä¸€ä¸ªyieldè¡¨è¾¾å¼,é‡è§yieldå°±åœæ­¢,åˆè¿”å›yieldåçš„è®¡ç®—å€¼
 *        { value: '888', done: false }
 */</span>
p<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* æ‰§è¡Œ4
 *        å°† yield 888æ•´ä¸ªè¡¨è¾¾å¼çš„å€¼è®¾ç½®ä¸ºnextä¼ å…¥çš„å‚æ•°,å¹¶èµ‹å€¼ç»™r
 *        æ‰“å°rçš„å€¼ä¸º  &quot;è‡ªå®šä¹‰ä¼ å‚&quot;
 *        { value: 'end', done: false }
 */</span>
p<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'è‡ªå®šä¹‰ä¼ å‚'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// æ‰§è¡Œ5   ç»“æŸGeneratorçš„æ‰§è¡Œ  { value: 'undefined', done: true }</span>
p<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="è‡ªåŠ¨æ‰§è¡Œ"><a href="#è‡ªåŠ¨æ‰§è¡Œ" class="header-anchor">#</a> è‡ªåŠ¨æ‰§è¡Œ</h3> <div class="custom-block warning"><p class="custom-block-title">æ³¨æ„</p> <p><code>await</code> åé¢çš„å‡½æ•°å¯ä»¥æ˜¯<code>promise</code> å¯¹è±¡ä¹Ÿå¯ä»¥æ˜¯æ™®é€š <code>function</code>ï¼Œè€Œ yield å…³é”®å­—åé¢å¿…é¡»å¾—æ˜¯ <code>thunk</code> å‡½æ•°æˆ– <code>promise</code> å¯¹è±¡</p></div> <p>ç›®å‰è‡ªåŠ¨æ‰§è¡Œçš„æ–¹æ¡ˆä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§:</p> <ul><li><code>Thunk å‡½æ•°</code> å°†å¼‚æ­¥æ“ä½œåŒ…è£…æˆ Thunk å‡½æ•°ï¼Œåœ¨å›è°ƒå‡½æ•°é‡Œé¢äº¤å›æ‰§è¡Œæƒ</li> <li><code>Promise å¯¹è±¡</code> å¼‚æ­¥æ“ä½œåŒ…è£…æˆ Promise å¯¹è±¡ï¼Œç”¨ then æ–¹æ³•äº¤å›æ‰§è¡Œæƒ</li> <li><code>å®Œå–„ç‰ˆ</code> åŒæ—¶æ”¯æŒå¼‚æ­¥ä¸åŒæ­¥å¤„ç†</li></ul> <h3 id="thunk-å‡½æ•°å®ç°"><a href="#thunk-å‡½æ•°å®ç°" class="header-anchor">#</a> Thunk å‡½æ•°å®ç°</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> gen <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token function">run</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="promise-å¯¹è±¡å®ç°"><a href="#promise-å¯¹è±¡å®ç°" class="header-anchor">#</a> Promise å¯¹è±¡å®ç°</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">gen</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> g <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token keyword">return</span> result<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">run</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// promiseç®€å•å®ç°</span>
<span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">gen</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> gen <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> result <span class="token operator">=</span> gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token function">toPromise</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

      value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
        <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">isPromise</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'function'</span> <span class="token operator">==</span> <span class="token keyword">typeof</span> obj<span class="token punctuation">.</span>then<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// objå¯ä»¥æ˜¯promiseä¹Ÿå¯ä»¥æ˜¯å›è°ƒå‡½æ•°,æ‰€ä»¥ç»Ÿä¸€è½¬åŒ–æˆpromise</span>
<span class="token keyword">function</span> <span class="token function">toPromise</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPromise</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'function'</span> <span class="token operator">==</span> <span class="token keyword">typeof</span> obj<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">thunkToPromise</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">thunkToPromise</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> run<span class="token punctuation">;</span>
</code></pre></div><p>ç»¼åˆæ¥çœ‹, éœ€è¦å¤„ç†ä¸¤ç§æƒ…å†µ, å³ yield åé¢æ˜¯å›è°ƒå‡½æ•°æˆ–è€… promise ç­‰ä¸¤ç§æƒ…å†µ</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// å›è°ƒå‡½æ•°çš„æƒ…å†µ</span>
<span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> data<span class="token operator">:</span> url <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> r1 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token string">'https://api.github.com/users/github'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> r2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token string">'https://api.github.com/users/github/followers'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span>r1<span class="token punctuation">.</span>data<span class="token punctuation">,</span> r2<span class="token punctuation">.</span>data<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="å®Œå–„ç‰ˆ"><a href="#å®Œå–„ç‰ˆ" class="header-anchor">#</a> å®Œå–„ç‰ˆ</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">gen</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> gen <span class="token operator">==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> gen <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// å¦‚æœ gen ä¸æ˜¯ä¸€ä¸ªè¿­ä»£å™¨</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gen <span class="token operator">||</span> <span class="token keyword">typeof</span> gen<span class="token punctuation">.</span>next <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> ret<span class="token punctuation">;</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        ret <span class="token operator">=</span> gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">next</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> ret<span class="token punctuation">;</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        ret <span class="token operator">=</span> gen<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">next</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter">ret</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token function">toPromise</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&amp;&amp;</span> <span class="token function">isPromise</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">onRejected</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span>
          <span class="token string">'You may only yield a function, promise '</span> <span class="token operator">+</span>
            <span class="token string">'but the following object was passed: &quot;'</span> <span class="token operator">+</span>
            <span class="token function">String</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token operator">+</span>
            <span class="token string">'&quot;'</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">isPromise</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'function'</span> <span class="token operator">==</span> <span class="token keyword">typeof</span> obj<span class="token punctuation">.</span>then<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">toPromise</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPromise</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'function'</span> <span class="token operator">==</span> <span class="token keyword">typeof</span> obj<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">thunkToPromise</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">thunkToPromise</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ›´å¤šå¯ä»¥äº†è§£ TJ å¤§ç¥çš„<a href="https://github.com/tj/co" target="_blank" rel="noopener noreferrer"><code>COæ¨¡å—</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">æ›´æ–°æ—¶é—´:</span> <span class="time">2/8/2021, 10:37:49 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/blog/skills/Promise.html" class="prev">
        Promise
      </a></span> <span class="next"><a href="/blog/skills/Set &amp; Map.html">
        Set &amp; Map
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/blog/assets/js/app.fca59600.js" defer></script><script src="/blog/assets/js/3.8a6bfa10.js" defer></script><script src="/blog/assets/js/23.f5fdb6b0.js" defer></script><script src="/blog/assets/js/4.3c831ab3.js" defer></script>
  </body>
</html>
