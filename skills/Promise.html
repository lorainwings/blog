<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Promise | Lorain&#39;s ä¸ªäººä¸»é¡µğŸ–Œ</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/blog/base/hd-img.jpg">
    <link rel="manifest" href="/blog/manifest.json">
    <link rel="apple-touch-icon" href="/blog/base/hd-img.jpg">
    <meta name="description" content="å±±ä¸­æ¨—æ å¹´å¹´åœ¨ & çœ‹å°½è¥¿é£æœ¨æ§¿èŠ±">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta http-quiv="pragma" cotent="no-cache">
    <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
    <meta http-quiv="expires" cotent="0">
    <link rel="preload" href="/blog/assets/css/0.styles.579a9854.css" as="style"><link rel="preload" href="/blog/assets/js/app.3271dfe6.js" as="script"><link rel="preload" href="/blog/assets/js/3.ab657a59.js" as="script"><link rel="preload" href="/blog/assets/js/23.3a3358e3.js" as="script"><link rel="preload" href="/blog/assets/js/4.022282fe.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.15efb885.js"><link rel="prefetch" href="/blog/assets/js/11.b69736a7.js"><link rel="prefetch" href="/blog/assets/js/12.1e4a5a90.js"><link rel="prefetch" href="/blog/assets/js/13.a0e2552d.js"><link rel="prefetch" href="/blog/assets/js/14.db5c8151.js"><link rel="prefetch" href="/blog/assets/js/15.a2f176cb.js"><link rel="prefetch" href="/blog/assets/js/16.5298f88a.js"><link rel="prefetch" href="/blog/assets/js/17.5f2beb7f.js"><link rel="prefetch" href="/blog/assets/js/18.e510d28d.js"><link rel="prefetch" href="/blog/assets/js/19.53886023.js"><link rel="prefetch" href="/blog/assets/js/20.63c552fe.js"><link rel="prefetch" href="/blog/assets/js/21.67e51d39.js"><link rel="prefetch" href="/blog/assets/js/22.42eb15fc.js"><link rel="prefetch" href="/blog/assets/js/24.e9e2a625.js"><link rel="prefetch" href="/blog/assets/js/25.096364ce.js"><link rel="prefetch" href="/blog/assets/js/26.0ccf51ed.js"><link rel="prefetch" href="/blog/assets/js/27.2f83da87.js"><link rel="prefetch" href="/blog/assets/js/28.f04b9341.js"><link rel="prefetch" href="/blog/assets/js/29.c8add927.js"><link rel="prefetch" href="/blog/assets/js/30.1aef2e5e.js"><link rel="prefetch" href="/blog/assets/js/31.1abd6355.js"><link rel="prefetch" href="/blog/assets/js/32.03df97b0.js"><link rel="prefetch" href="/blog/assets/js/33.c00a706c.js"><link rel="prefetch" href="/blog/assets/js/34.2f847376.js"><link rel="prefetch" href="/blog/assets/js/35.63347724.js"><link rel="prefetch" href="/blog/assets/js/36.9fdc020c.js"><link rel="prefetch" href="/blog/assets/js/37.3392c04b.js"><link rel="prefetch" href="/blog/assets/js/38.ade4c9de.js"><link rel="prefetch" href="/blog/assets/js/39.6aec4626.js"><link rel="prefetch" href="/blog/assets/js/40.9c723d93.js"><link rel="prefetch" href="/blog/assets/js/5.904e5833.js"><link rel="prefetch" href="/blog/assets/js/6.2426cfb9.js"><link rel="prefetch" href="/blog/assets/js/7.7194594b.js"><link rel="prefetch" href="/blog/assets/js/8.e15df7e7.js"><link rel="prefetch" href="/blog/assets/js/9.3ff9262b.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.21b1897d.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.579a9854.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Lorain's ä¸ªäººä¸»é¡µğŸ–Œ</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/skills/" class="nav-link router-link-active">
  ğŸ“œæŠ€æœ¯è¿›é˜¶
</a></div><div class="nav-item"><a href="/blog/algorithm/" class="nav-link">
  ğŸ“Šç®—æ³•ç›¸å…³
</a></div><div class="nav-item"><a href="/blog/life/" class="nav-link">
  ğŸ€è®°å½•ç”Ÿæ´»
</a></div><div class="nav-item"><a href="https://github.com/lorainwings" target="_blank" rel="noopener noreferrer" class="nav-link external">
  â­ï¸Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/skills/" class="nav-link router-link-active">
  ğŸ“œæŠ€æœ¯è¿›é˜¶
</a></div><div class="nav-item"><a href="/blog/algorithm/" class="nav-link">
  ğŸ“Šç®—æ³•ç›¸å…³
</a></div><div class="nav-item"><a href="/blog/life/" class="nav-link">
  ğŸ€è®°å½•ç”Ÿæ´»
</a></div><div class="nav-item"><a href="https://github.com/lorainwings" target="_blank" rel="noopener noreferrer" class="nav-link external">
  â­ï¸Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Client &amp; Side</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/skills/Base64.html" class="sidebar-link">Base64</a></li><li><a href="/blog/skills/Promise.html" aria-current="page" class="active sidebar-link">Promise</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/skills/Promise.html#å®ç°ç®€æ˜“ç‰ˆ-promise" class="sidebar-link">å®ç°ç®€æ˜“ç‰ˆ Promise</a></li><li class="sidebar-sub-header"><a href="/blog/skills/Promise.html#å®ç°-ç¬¦åˆ-promise-a-è§„èŒƒçš„-promise" class="sidebar-link">å®ç° ç¬¦åˆ Promise/A+ è§„èŒƒçš„ Promise</a></li><li class="sidebar-sub-header"><a href="/blog/skills/Promise.html#å°ç»“" class="sidebar-link">å°ç»“</a></li></ul></li><li><a href="/blog/skills/å›¾ç‰‡åˆ†ç±».html" class="sidebar-link">å›¾ç‰‡åˆ†ç±»</a></li><li><a href="/blog/skills/Rxjsåˆæ¢.html" class="sidebar-link">Rxjs åˆæ¢</a></li><li><a href="/blog/skills/Generator.html" class="sidebar-link">Generator</a></li><li><a href="/blog/skills/Set &amp; Map.html" class="sidebar-link">Set &amp; Map</a></li><li><a href="/blog/skills/Babelæ‚è°ˆ.html" class="sidebar-link">Babel æ‚è°ˆ</a></li><li><a href="/blog/skills/H5å®šä½API.html" class="sidebar-link">H5 å®šä½ API</a></li><li><a href="/blog/skills/Event-loop.html" class="sidebar-link">Event Loop</a></li><li><a href="/blog/skills/æœåŠ¡å™¨æ¨é€.html" class="sidebar-link">æœåŠ¡å™¨æ¨é€</a></li><li><a href="/blog/skills/æµè§ˆå™¨ç¼“å­˜.html" class="sidebar-link">æµè§ˆå™¨ç¼“å­˜</a></li><li><a href="/blog/skills/å‰ç«¯å®‰å…¨é˜²èŒƒ.html" class="sidebar-link">å‰ç«¯å®‰å…¨é˜²èŒƒ</a></li><li><a href="/blog/skills/åˆè¯†Typescript.html" class="sidebar-link">åˆè¯† Typescript</a></li><li><a href="/blog/skills/Git å¸¸ç”¨æŠ€å·§.html" class="sidebar-link">Git å¸¸ç”¨æŠ€å·§</a></li><li><a href="/blog/skills/Webæ€§èƒ½ä¼˜åŒ–.html" class="sidebar-link">Web æ€§èƒ½ä¼˜åŒ–</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Build &amp; Tools</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Design &amp; Patterns</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Server &amp; Side</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="promise"><a href="#promise" class="header-anchor">#</a> Promise</h1> <p>åœ¨ä¸Šä¸€ç« èŠ‚ä¸­æˆ‘ä»¬äº†è§£äº† <code>Promise</code> çš„ä¸€äº›æ˜“é”™ç‚¹ï¼Œåœ¨è¿™ä¸€ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡æ‰‹å†™ä¸€ä¸ªç¬¦åˆ Promise/A+ è§„èŒƒçš„ <code>Promise</code> æ¥æ·±å…¥ç†è§£å®ƒï¼Œå¹¶ä¸”æ‰‹å†™ <code>Promise</code> ä¹Ÿæ˜¯ä¸€é“å¤§å‚å¸¸è€ƒé¢˜ï¼Œåœ¨è¿›å…¥æ­£é¢˜ä¹‹å‰ï¼Œæ¨èå„ä½é˜…è¯»ä¸€ä¸‹ <a href="https://link.juejin.im/?target=http%3A%2F%2Fwww.ituring.com.cn%2Farticle%2F66566" target="_blank" rel="noopener noreferrer">Promise/A+ è§„èŒƒ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œè¿™æ ·æ‰èƒ½æ›´å¥½åœ°ç†è§£è¿™ä¸ªç« èŠ‚çš„ä»£ç ã€‚</p> <h2 id="å®ç°ç®€æ˜“ç‰ˆ-promise"><a href="#å®ç°ç®€æ˜“ç‰ˆ-promise" class="header-anchor">#</a> å®ç°ç®€æ˜“ç‰ˆ Promise</h2> <p>åœ¨å®Œæˆç¬¦åˆ Promise/A+ è§„èŒƒçš„ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ¥å®ç°ä¸€ä¸ªç®€æ˜“ç‰ˆ <code>Promise</code>ï¼Œå› ä¸ºåœ¨é¢è¯•ä¸­ï¼Œå¦‚æœä½ èƒ½å®ç°å‡ºä¸€ä¸ªç®€æ˜“ç‰ˆçš„ <code>Promise</code> åŸºæœ¬å¯ä»¥è¿‡å…³äº†ã€‚</p> <p>é‚£ä¹ˆæˆ‘ä»¬å…ˆæ¥æ­å»ºæ„å»ºå‡½æ•°çš„å¤§ä½“æ¡†æ¶</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">RESOLVED</span> <span class="token operator">=</span> <span class="token string">'resolved'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">MyPromise</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  that<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token constant">PENDING</span><span class="token punctuation">;</span>
  that<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  that<span class="token punctuation">.</span>resolvedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  that<span class="token punctuation">.</span>rejectedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// å¾…å®Œå–„ resolve å’Œ reject å‡½æ•°// å¾…å®Œå–„æ‰§è¡Œ fn å‡½æ•°</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºäº†ä¸‰ä¸ªå¸¸é‡ç”¨äºè¡¨ç¤ºçŠ¶æ€ï¼Œå¯¹äºç»å¸¸ä½¿ç”¨çš„ä¸€äº›å€¼éƒ½åº”è¯¥é€šè¿‡å¸¸é‡æ¥ç®¡ç†ï¼Œä¾¿äºå¼€å‘åŠåæœŸç»´æŠ¤</li> <li>åœ¨å‡½æ•°ä½“å†…éƒ¨é¦–å…ˆåˆ›å»ºäº†å¸¸é‡ <code>that</code>ï¼Œå› ä¸ºä»£ç å¯èƒ½ä¼šå¼‚æ­¥æ‰§è¡Œï¼Œç”¨äºè·å–æ­£ç¡®çš„ <code>this</code> å¯¹è±¡</li> <li>ä¸€å¼€å§‹ <code>Promise</code> çš„çŠ¶æ€åº”è¯¥æ˜¯ <code>pending</code></li> <li><code>value</code> å˜é‡ç”¨äºä¿å­˜ <code>resolve</code> æˆ–è€… <code>reject</code> ä¸­ä¼ å…¥çš„å€¼</li> <li><code>resolvedCallbacks</code> å’Œ <code>rejectedCallbacks</code> ç”¨äºä¿å­˜ <code>then</code> ä¸­çš„å›è°ƒï¼Œå› ä¸ºå½“æ‰§è¡Œå®Œ <code>Promise</code> æ—¶çŠ¶æ€å¯èƒ½è¿˜æ˜¯ç­‰å¾…ä¸­ï¼Œè¿™æ—¶å€™åº”è¯¥æŠŠ <code>then</code> ä¸­çš„å›è°ƒä¿å­˜èµ·æ¥ç”¨äºçŠ¶æ€æ”¹å˜æ—¶ä½¿ç”¨</li></ul> <p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®Œå–„ <code>resolve</code> å’Œ <code>reject</code> å‡½æ•°ï¼Œæ·»åŠ åœ¨ <code>MyPromise</code> å‡½æ•°ä½“å†…éƒ¨</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    that<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token constant">RESOLVED</span><span class="token punctuation">;</span>
    that<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
    that<span class="token punctuation">.</span>resolvedCallbacks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">cb</span> <span class="token operator">=&gt;</span> <span class="token function">cb</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    that<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token constant">REJECTED</span><span class="token punctuation">;</span>
    that<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
    that<span class="token punctuation">.</span>rejectedCallbacks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">cb</span> <span class="token operator">=&gt;</span> <span class="token function">cb</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™ä¸¤ä¸ªå‡½æ•°ä»£ç ç±»ä¼¼ï¼Œå°±ä¸€èµ·è§£æäº†</p> <ul><li>é¦–å…ˆä¸¤ä¸ªå‡½æ•°éƒ½å¾—åˆ¤æ–­å½“å‰çŠ¶æ€æ˜¯å¦ä¸ºç­‰å¾…ä¸­ï¼Œå› ä¸ºè§„èŒƒè§„å®šåªæœ‰ç­‰å¾…æ€æ‰å¯ä»¥æ”¹å˜çŠ¶æ€</li> <li>å°†å½“å‰çŠ¶æ€æ›´æ”¹ä¸ºå¯¹åº”çŠ¶æ€ï¼Œå¹¶ä¸”å°†ä¼ å…¥çš„å€¼èµ‹å€¼ç»™ <code>value</code></li> <li>éå†å›è°ƒæ•°ç»„å¹¶æ‰§è¡Œ</li></ul> <p>å®Œæˆä»¥ä¸Šä¸¤ä¸ªå‡½æ•°ä»¥åï¼Œæˆ‘ä»¬å°±è¯¥å®ç°å¦‚ä½•æ‰§è¡Œ <code>Promise</code> ä¸­ä¼ å…¥çš„å‡½æ•°äº†</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token function">fn</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>å®ç°å¾ˆç®€å•ï¼Œæ‰§è¡Œä¼ å…¥çš„å‚æ•°å¹¶ä¸”å°†ä¹‹å‰ä¸¤ä¸ªå‡½æ•°å½“åšå‚æ•°ä¼ è¿›å»</li> <li>è¦æ³¨æ„çš„æ˜¯ï¼Œå¯èƒ½æ‰§è¡Œå‡½æ•°è¿‡ç¨‹ä¸­ä¼šé‡åˆ°é”™è¯¯ï¼Œéœ€è¦æ•è·é”™è¯¯å¹¶ä¸”æ‰§è¡Œ <code>reject</code> å‡½æ•°</li></ul> <p>æœ€åæˆ‘ä»¬æ¥å®ç°è¾ƒä¸ºå¤æ‚çš„ <code>then</code> å‡½æ•°</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">MyPromise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  onFulfilled <span class="token operator">=</span> <span class="token keyword">typeof</span> onFulfilled <span class="token operator">===</span> <span class="token string">'function '</span> <span class="token operator">?</span> <span class="token function-variable function">onFulfilled</span> <span class="token operator">:</span> <span class="token parameter">v</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">;</span>
  onRejected <span class="token operator">=</span>
    <span class="token keyword">typeof</span> onRejected <span class="token operator">===</span> <span class="token string">'function '</span>
      <span class="token operator">?</span> <span class="token function-variable function">onRejected</span>
      <span class="token operator">:</span> <span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> r<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    that<span class="token punctuation">.</span>resolvedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">)</span><span class="token punctuation">;</span>
    that<span class="token punctuation">.</span>rejectedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token constant">RESOLVED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">onFulfilled</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">onRejected</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>é¦–å…ˆåˆ¤æ–­ä¸¤ä¸ªå‚æ•°æ˜¯å¦ä¸ºå‡½æ•°ç±»å‹ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå‚æ•°æ˜¯å¯é€‰å‚æ•°</p></li> <li><p>å½“å‚æ•°ä¸æ˜¯å‡½æ•°ç±»å‹æ—¶ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªå‡½æ•°èµ‹å€¼ç»™å¯¹åº”çš„å‚æ•°ï¼ŒåŒæ—¶ä¹Ÿå®ç°äº†é€ä¼ ï¼Œæ¯”å¦‚å¦‚ä¸‹ä»£ç </p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// è¯¥ä»£ç ç›®å‰åœ¨ç®€å•ç‰ˆä¸­ä¼šæŠ¥é”™</span>
<span class="token comment">// åªæ˜¯ä½œä¸ºä¸€ä¸ªé€ä¼ çš„ä¾‹å­</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>æ¥ä¸‹æ¥å°±æ˜¯ä¸€ç³»åˆ—åˆ¤æ–­çŠ¶æ€çš„é€»è¾‘ï¼Œå½“çŠ¶æ€ä¸æ˜¯ç­‰å¾…æ€æ—¶ï¼Œå°±å»æ‰§è¡Œç›¸å¯¹åº”çš„å‡½æ•°ã€‚å¦‚æœçŠ¶æ€æ˜¯ç­‰å¾…æ€çš„è¯ï¼Œå°±å¾€å›è°ƒå‡½æ•°ä¸­ <code>push</code> å‡½æ•°ï¼Œæ¯”å¦‚å¦‚ä¸‹ä»£ç å°±ä¼šè¿›å…¥ç­‰å¾…æ€çš„é€»è¾‘</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ä»¥ä¸Šå°±æ˜¯ç®€å•ç‰ˆ <code>Promise</code> å®ç°ï¼Œæ¥ä¸‹æ¥ä¸€å°èŠ‚æ˜¯å®ç°å®Œæ•´ç‰ˆ <code>Promise</code> çš„è§£æï¼Œç›¸ä¿¡çœ‹å®Œå®Œæ•´ç‰ˆçš„ä½ ï¼Œä¸€å®šä¼šå¯¹äº <code>Promise</code> çš„ç†è§£æ›´ä¸Šä¸€å±‚æ¥¼ã€‚</p> <h2 id="å®ç°-ç¬¦åˆ-promise-a-è§„èŒƒçš„-promise"><a href="#å®ç°-ç¬¦åˆ-promise-a-è§„èŒƒçš„-promise" class="header-anchor">#</a> å®ç° ç¬¦åˆ Promise/A+ è§„èŒƒçš„ Promise</h2> <p>è¿™å°èŠ‚ä»£ç éœ€è¦å¤§å®¶é…åˆè§„èŒƒé˜…è¯»ï¼Œå› ä¸ºå¤§éƒ¨åˆ†ä»£ç éƒ½æ˜¯æ ¹æ®è§„èŒƒå»å®ç°çš„ã€‚</p> <p>æˆ‘ä»¬å…ˆæ¥æ”¹é€ ä¸€ä¸‹ <code>resolve</code> å’Œ <code>reject</code> å‡½æ•°</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">MyPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      that<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token constant">RESOLVED</span><span class="token punctuation">;</span>
      that<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
      that<span class="token punctuation">.</span>resolvedCallbacks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">cb</span> <span class="token operator">=&gt;</span> <span class="token function">cb</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      that<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token constant">REJECTED</span><span class="token punctuation">;</span>
      that<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
      that<span class="token punctuation">.</span>rejectedCallbacks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">cb</span> <span class="token operator">=&gt;</span> <span class="token function">cb</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>å¯¹äº <code>resolve</code> å‡½æ•°æ¥è¯´ï¼Œé¦–å…ˆéœ€è¦åˆ¤æ–­ä¼ å…¥çš„å€¼æ˜¯å¦ä¸º <code>Promise</code> ç±»å‹</li> <li>ä¸ºäº†ä¿è¯å‡½æ•°æ‰§è¡Œé¡ºåºï¼Œéœ€è¦å°†ä¸¤ä¸ªå‡½æ•°ä½“ä»£ç ä½¿ç”¨ <code>setTimeout</code> åŒ…è£¹èµ·æ¥</li></ul> <p>æ¥ä¸‹æ¥ç»§ç»­æ”¹é€  <code>then</code> å‡½æ•°ä¸­çš„ä»£ç ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ–°å¢ä¸€ä¸ªå˜é‡ <code>promise2</code>ï¼Œå› ä¸ºæ¯ä¸ª <code>then</code> å‡½æ•°éƒ½éœ€è¦è¿”å›ä¸€ä¸ªæ–°çš„ <code>Promise</code> å¯¹è±¡ï¼Œè¯¥å˜é‡ç”¨äºä¿å­˜æ–°çš„è¿”å›å¯¹è±¡ï¼Œç„¶åæˆ‘ä»¬å…ˆæ¥æ”¹é€ åˆ¤æ–­ç­‰å¾…æ€çš„é€»è¾‘</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>promise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    that<span class="token punctuation">.</span>resolvedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolutionProcedure</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    that<span class="token punctuation">.</span>rejectedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolutionProcedure</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>é¦–å…ˆæˆ‘ä»¬è¿”å›äº†ä¸€ä¸ªæ–°çš„ <code>Promise</code> å¯¹è±¡ï¼Œå¹¶åœ¨ <code>Promise</code> ä¸­ä¼ å…¥äº†ä¸€ä¸ªå‡½æ•°</li> <li>å‡½æ•°çš„åŸºæœ¬é€»è¾‘è¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·ï¼Œå¾€å›è°ƒæ•°ç»„ä¸­ <code>push</code> å‡½æ•°</li> <li>åŒæ ·ï¼Œåœ¨æ‰§è¡Œå‡½æ•°çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°é”™è¯¯ï¼Œæ‰€ä»¥ä½¿ç”¨äº† <code>try...catch</code> åŒ…è£¹</li> <li>è§„èŒƒè§„å®šï¼Œæ‰§è¡Œ <code>onFulfilled</code> æˆ–è€… <code>onRejected</code> å‡½æ•°æ—¶ä¼šè¿”å›ä¸€ä¸ª <code>x</code>ï¼Œå¹¶ä¸”æ‰§è¡Œ <code>Promise</code> è§£å†³è¿‡ç¨‹ï¼Œè¿™æ˜¯ä¸ºäº†ä¸åŒçš„ <code>Promise</code> éƒ½å¯ä»¥å…¼å®¹ä½¿ç”¨ï¼Œæ¯”å¦‚ JQuery çš„ <code>Promise</code> èƒ½å…¼å®¹ ES6 çš„ <code>Promise</code></li></ul> <p>æ¥ä¸‹æ¥æˆ‘ä»¬æ”¹é€ åˆ¤æ–­æ‰§è¡Œæ€çš„é€»è¾‘</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token constant">RESOLVED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>promise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolutionProcedure</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>reason<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>å…¶å®å¤§å®¶å¯ä»¥å‘ç°è¿™æ®µä»£ç å’Œåˆ¤æ–­ç­‰å¾…æ€çš„é€»è¾‘åŸºæœ¬ä¸€è‡´ï¼Œæ— éæ˜¯ä¼ å…¥çš„å‡½æ•°çš„å‡½æ•°ä½“éœ€è¦å¼‚æ­¥æ‰§è¡Œï¼Œè¿™ä¹Ÿæ˜¯è§„èŒƒè§„å®šçš„</li> <li>å¯¹äºåˆ¤æ–­æ‹’ç»æ€çš„é€»è¾‘è¿™é‡Œå°±ä¸ä¸€ä¸€èµ˜è¿°äº†ï¼Œç•™ç»™å¤§å®¶è‡ªå·±å®Œæˆè¿™ä¸ªä½œä¸š</li></ul> <p>æœ€åï¼Œå½“ç„¶ä¹Ÿæ˜¯æœ€éš¾çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯å®ç°å…¼å®¹å¤šç§ <code>Promise</code> çš„ <code>resolutionProcedure</code> å‡½æ•°</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">resolutionProcedure</span><span class="token punctuation">(</span><span class="token parameter">promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>promise2 <span class="token operator">===</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token function">newTypeError</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>é¦–å…ˆè§„èŒƒè§„å®šäº† <code>x</code> ä¸èƒ½ä¸ <code>promise2</code> ç›¸ç­‰ï¼Œè¿™æ ·ä¼šå‘ç”Ÿå¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œæ¯”å¦‚å¦‚ä¸‹ä»£ç </p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p1 <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> p1<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ç„¶åéœ€è¦åˆ¤æ–­ <code>x</code> çš„ç±»å‹</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token keyword">instanceof</span> <span class="token class-name">MyPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  x<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resolutionProcedure</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> value<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™é‡Œçš„ä»£ç æ˜¯å®Œå…¨æŒ‰ç…§è§„èŒƒå®ç°çš„ã€‚å¦‚æœ <code>x</code> ä¸º <code>Promise</code> çš„è¯ï¼Œéœ€è¦åˆ¤æ–­ä»¥ä¸‹å‡ ä¸ªæƒ…å†µï¼š</p> <ol><li>å¦‚æœ <code>x</code> å¤„äºç­‰å¾…æ€ï¼Œ<code>Promise</code> éœ€ä¿æŒä¸ºç­‰å¾…æ€ç›´è‡³ <code>x</code> è¢«æ‰§è¡Œæˆ–æ‹’ç»</li> <li>å¦‚æœ <code>x</code> å¤„äºå…¶ä»–çŠ¶æ€ï¼Œåˆ™ç”¨ç›¸åŒçš„å€¼å¤„ç† <code>Promise</code></li></ol> <p>å½“ç„¶ä»¥ä¸Šè¿™äº›æ˜¯è§„èŒƒéœ€è¦æˆ‘ä»¬åˆ¤æ–­çš„æƒ…å†µï¼Œå®é™…ä¸Šæˆ‘ä»¬ä¸åˆ¤æ–­çŠ¶æ€ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚</p> <p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­æŒ‰ç…§è§„èŒƒæ¥å®ç°å‰©ä½™çš„ä»£ç </p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">let</span> called <span class="token operator">=</span> <span class="token function">falseif</span> <span class="token punctuation">(</span>x <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">'function '</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> then <span class="token operator">=</span> x<span class="token punctuation">.</span>then
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> then <span class="token operator">===</span> <span class="token string">'function '</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">then</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
            x<span class="token punctuation">,</span>
            <span class="token parameter">y</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span>
              called <span class="token operator">=</span> <span class="token boolean">true</span>
              <span class="token function">resolutionProcedure</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> y<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span>
              called <span class="token operator">=</span> <span class="token boolean">true</span>
              <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span>
        called <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre></div><ul><li>é¦–å…ˆåˆ›å»ºä¸€ä¸ªå˜é‡ <code>called</code> ç”¨äºåˆ¤æ–­æ˜¯å¦å·²ç»è°ƒç”¨è¿‡å‡½æ•°</li> <li>ç„¶ååˆ¤æ–­ <code>x</code> æ˜¯å¦ä¸ºå¯¹è±¡æˆ–è€…å‡½æ•°ï¼Œå¦‚æœéƒ½ä¸æ˜¯çš„è¯ï¼Œå°† <code>x</code> ä¼ å…¥ <code>resolve</code> ä¸­</li> <li>å¦‚æœ <code>x</code> æ˜¯å¯¹è±¡æˆ–è€…å‡½æ•°çš„è¯ï¼Œå…ˆæŠŠ <code>x.then</code> èµ‹å€¼ç»™ <code>then</code>ï¼Œç„¶ååˆ¤æ–­ <code>then</code> çš„ç±»å‹ï¼Œå¦‚æœä¸æ˜¯å‡½æ•°ç±»å‹çš„è¯ï¼Œå°±å°† <code>x</code> ä¼ å…¥ <code>resolve</code> ä¸­</li> <li>å¦‚æœ <code>then</code> æ˜¯å‡½æ•°ç±»å‹çš„è¯ï¼Œå°±å°† <code>x</code> ä½œä¸ºå‡½æ•°çš„ä½œç”¨åŸŸ <code>this</code> è°ƒç”¨ä¹‹ï¼Œå¹¶ä¸”ä¼ é€’ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å«åš <code>resolvePromise</code> ï¼Œç¬¬äºŒä¸ªå‚æ•°å«åš <code>rejectPromise</code>ï¼Œä¸¤ä¸ªå›è°ƒå‡½æ•°éƒ½éœ€è¦åˆ¤æ–­æ˜¯å¦å·²ç»æ‰§è¡Œè¿‡å‡½æ•°ï¼Œç„¶åè¿›è¡Œç›¸åº”çš„é€»è¾‘</li> <li>ä»¥ä¸Šä»£ç åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¦‚æœæŠ›é”™äº†ï¼Œå°†é”™è¯¯ä¼ å…¥ <code>reject</code> å‡½æ•°ä¸­</li></ul> <p>ä»¥ä¸Šå°±æ˜¯ç¬¦åˆ Promise/A+ è§„èŒƒçš„å®ç°äº†ï¼Œå¦‚æœä½ å¯¹äºè¿™éƒ¨åˆ†ä»£ç å°šæœ‰ç–‘é—®ï¼Œæ¬¢è¿åœ¨è¯„è®ºä¸­ä¸æˆ‘äº’åŠ¨ã€‚</p> <h2 id="å°ç»“"><a href="#å°ç»“" class="header-anchor">#</a> å°ç»“</h2> <p>è¿™ä¸€ç« èŠ‚æˆ‘ä»¬åˆ†åˆ«å®ç°äº†ç®€å•ç‰ˆå’Œç¬¦åˆ Promise/A+ è§„èŒƒçš„ <code>Promise</code>ï¼Œå‰è€…å·²ç»è¶³å¤Ÿåº”ä»˜å¤§éƒ¨åˆ†é¢è¯•çš„æ‰‹å†™é¢˜ç›®ï¼Œæ¯•ç«Ÿå†™å‡ºä¸€ä¸ªç¬¦åˆè§„èŒƒçš„ <code>Promise</code> åœ¨é¢è¯•ä¸­ä¸å¤§ç°å®ã€‚åè€…èƒ½è®©ä½ æ›´åŠ æ·±å…¥åœ°ç†è§£ <code>Promise</code> çš„è¿è¡ŒåŸç†ï¼ŒåšæŠ€æœ¯çš„æ·±æŒ–è€…ã€‚</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">æ›´æ–°æ—¶é—´:</span> <span class="time">7/17/2020, 12:29:42 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/blog/skills/Base64.html" class="prev">
        Base64
      </a></span> <span class="next"><a href="/blog/skills/å›¾ç‰‡åˆ†ç±».html">
        å›¾ç‰‡åˆ†ç±»
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/blog/assets/js/app.3271dfe6.js" defer></script><script src="/blog/assets/js/3.ab657a59.js" defer></script><script src="/blog/assets/js/23.3a3358e3.js" defer></script><script src="/blog/assets/js/4.022282fe.js" defer></script>
  </body>
</html>
